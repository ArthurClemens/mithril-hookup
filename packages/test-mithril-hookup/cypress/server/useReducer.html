<html>
<body>
  <div id="root"></div>
  <script src="./js/mithril@1.1.6.js"></script>
  <script src="../../node_modules/mithril-hookup/dist/mithril-hookup.js"></script>
  <script>
const hookup = mithrilHookup.hookup;

const counterReducer = (state, action) => {
  switch (action.type) {
    case "increment":
      return { count: state.count + 1 }
    case "decrement":
      return { count: state.count - 1 }
    default:
      throw new Error("Unhandled action:", action)
  }
};

const ReducerInitFunction = hookup(
  (
    { attrs: { initialCount }},
    { useReducer }
  ) => {
  // test setting state using init function
  const initState = value => ({ count: value });
  const [countState, dispatch] = useReducer(counterReducer, initialCount, initState);
  const count = countState.count;

  return m("[data-test-id=ReducerInitFunction]", [
    m("h2", "ReducerInitFunction"),
    m("p", [
      m("span", "count: "),
      m("span[data-test-id=count]", count)
    ]),
    m("p", [
      m("span", "state: "),
      m("span[data-test-id=state]", JSON.stringify(countState))
    ]),
  ]);
});

const ReducerCounter = hookup(
  (
    { attrs: { initialCount }},
    { useReducer }
  ) => {
  const [countState, dispatch] = useReducer(counterReducer, { count: initialCount });
  const count = countState.count;

  return m("[data-test-id=ReducerCounter]", [
    m("h2", "ReducerCounter"),
    m("p", [
      m("span", "count: "),
      m("span[data-test-id=count]", count)
    ]),
    m("p", [
      m("span", "state: "),
      m("span[data-test-id=state]", JSON.stringify(countState))
    ]),
    m("button[data-test-id=decrement]", {
      disabled: count === 0,
      onclick: () => dispatch({ type: "decrement" })
    }, "Less"),
    m("button[data-test-id=increment]", {
      onclick: () => dispatch({ type: "increment" })
    }, "More")
  ]);
});

const App = {
  view: () => [
    m(ReducerCounter, { initialCount: 10 }),
    m(ReducerInitFunction, { initialCount: 99 }),
  ]
}

m.mount(
  document.querySelector("#root"),
  App
);

  </script>
</body>
</html>
